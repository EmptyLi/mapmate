<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Matthew Leonawicz" />

<meta name="date" content="2016-11-15" />

<title>Usage examples and limitations</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; } /* Keyword */
code > span.dt { color: #dfdfbf; } /* DataType */
code > span.dv { color: #dcdccc; } /* DecVal */
code > span.bn { color: #dca3a3; } /* BaseN */
code > span.fl { color: #c0bed1; } /* Float */
code > span.ch { color: #dca3a3; } /* Char */
code > span.st { color: #cc9393; } /* String */
code > span.co { color: #7f9f7f; } /* Comment */
code > span.ot { color: #efef8f; } /* Other */
code > span.al { color: #ffcfaf; } /* Alert */
code > span.fu { color: #efef8f; } /* Function */
code > span.er { color: #c3bf9f; } /* Error */
code > span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
code > span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code > span.sc { color: #dca3a3; } /* SpecialChar */
code > span.vs { color: #cc9393; } /* VerbatimString */
code > span.ss { color: #cc9393; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #f0dfaf; } /* ControlFlow */
code > span.op { color: #f0efd0; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #7f9f7f; } /* Documentation */
code > span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code > span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code > span.in { color: #7f9f7f; font-weight: bold; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">mapmate</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>

    Home
  </a>
</li>
<li>
  <a href="mapmate.html">
    <span class="fa fa-info fa-lg"></span>

    Introduction
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-globe fa-lg"></span>

    Visual examples

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="usage_and_limitations.html">Usage &amp; limitations</a>
    </li>
    <li>
      <a href="networks.html">Network maps</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leonawicz/mapmate">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Usage examples and limitations</h1>
<h4 class="author"><em>Matthew Leonawicz</em></h4>
<h4 class="date"><em>2016-11-15</em></h4>

</div>


<!-- usage_and_limitations.md is generated from usage_and_limitations.Rmd. Please edit that file -->
<p>To install the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">&quot;leonawicz/mapmate&quot;</span>)</code></pre></div>
<div id="introduction-and-motivation" class="section level1">
<h1>Introduction and motivation</h1>
<p>The <code>mapmate</code> package is used for map- and globe-based data animation pre-production. Specifically, <code>mapmate</code> functions are used to generate and save to disk a series of map graphics that make up a still image sequence, which can then be used in video editing and rendering software of the user’s choice. This package does not make simple animations directly within R, which can be done with packages like <code>animation</code>. <code>mapmate</code> is more specific to maps, hence the name, and particularly suited to 3D globe plots of the Earth.</p>
<p>The motivation for the package is to assist with heavy data processing and image production for large, complex data animation videos that can require a significant amount of computing resources to create. It is best suited to use on a Linux server with a significant number of CPU cores and a significant amount of RAM, but all examples presented here are simple and have no such requirements. <code>mapmate</code> is all about video pre-production. Still image sequences created by R are meant to be rendered into video subsequently by dedicated video editing software. It makes the most sense to leverage the power of both programs for what they are best designed for: R for data analysis and plotting and something else for high quality video rendering.</p>
<p>As mentioned, there are other solutions for producing animations completely from R with only implicit external software dependencies (e.g., using the <code>rgl</code> package or relying on <code>ImageMagick convert</code>). The only restriction is that you have to want to create an animation that is small and simple enough for other solutions to remain realistic options. At some point the size of data or the images or the total number of frame or some other limitation may creep in and stop you if your animation is just simply too big or complex. At that point, this package has the value of being dedicated to generating still image sequences to pass to another program. If you ever make videos which require the use of video editing software, then you will know at what point it makes sense to just make still image sequences that you can drop on your timeline to finish your video project rather than trying to force R to do the entire job itself.</p>
<p>Nevertheless, while the strength of R for pre-production lies in its data analysis, processing and graphing capabilities, there are some limitations to how well <code>save_map</code> in the <code>mapmate</code> package will draw certain types of maps of certain types of data sets. The biggest limitation is in attempting to draw filled in polygons on a map using an orthographic projection; the 3D Earth globe view.</p>
<p>Below is a series of usage examples of <code>save_map</code> applied to example data included in the package. The examples show how to make different maps based on the different arguments that can be passed to <code>save_map</code>. They also show how some of the map type options available in <code>save_map</code> are primarily included to reveal their current limitations in drawing maps. Points, paths and tiles tend to work well, as do contour lines for the most part, but polygons often display serious clipping issues.</p>
<p>This package depends heavily on <code>ggplot2</code> for plotting. While it is easy enough to write a function that takes the lon/lat centroid of the visible hemisphere and returns an ordered set of lon/lat coordinates defining the circle that represents the hemisphere’s outer edge for orthographically projected data, I have not yet found a way in this context to use that circle to essentially reclip the polygons. If I could do so, then I could potentially apply the reclipping inside <code>save_map</code> when <code>ortho=TRUE</code> prior to the reprojection done by <code>ggplot2::coord_map</code>. But not so easily, if the data are not actually projected to the orthographic projection until passed inside <code>coord_map</code>. The reliance on <code>coord_map</code> could cripple my ability to insert a reclipping step where I need to, but I haven’t delved into it yet since my main use of the package is not for polygons.</p>
<p>Lastly, since these examples are simply intended to display what kind of map outputs are made given the various arguments that can be passed to <code>save_map</code>, the plot or image frame number/ID value never goes beyond <code>1</code> and <code>save_map</code> is not called iteratively in any of these examples. For code related to typical map sequence generation see the introductory vignette for examples: <code>browseVignettes(package=&quot;mapmate&quot;)</code> or <a href="mapmate.html">view it here</a>.</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>First some setup using the package data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mapmate)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(RColorBrewer)
pal &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">11</span>, <span class="st">&quot;RdYlBu&quot;</span>))

<span class="kw">data</span>(annualtemps)
<span class="kw">data</span>(borders)
<span class="kw">data</span>(bathymetry)

id &lt;-<span class="st"> &quot;frameID&quot;</span>
temps &lt;-<span class="st"> </span><span class="kw">mutate</span>(annualtemps, <span class="dt">frameID =</span> Year -<span class="st"> </span><span class="kw">min</span>(Year) +<span class="st"> </span><span class="dv">1</span>) %&gt;%<span class="st"> </span><span class="kw">filter</span>(frameID ==<span class="st"> </span>
<span class="st">    </span><span class="dv">1</span>)  <span class="co"># subset to first frame</span>
brdrs &lt;-<span class="st"> </span><span class="kw">mutate</span>(borders, <span class="dt">frameID =</span> <span class="dv">1</span>)
bath &lt;-<span class="st"> </span><span class="kw">mutate</span>(bathymetry, <span class="dt">frameID =</span> <span class="dv">1</span>)</code></pre></div>
<p>Next for the plots. Note that the aptly named <code>save_map</code> is not typically used for returning plot objects but rather for saving them to disk, hence why every call to <code>save_map</code> in this set of examples must explicitly include the non-default <code>save.plot</code> and <code>return.plot</code> arguments.</p>
</div>
<div id="flat-world-maps-vs-3d-earth" class="section level1">
<h1>Flat world maps vs 3D Earth</h1>
<p>Use <code>ortho=TRUE</code> (default) or <code>ortho=FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">ortho =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-flat_vs_globe-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> <span class="st">&quot;#FF4500&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>,
    <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-flat_vs_globe-2.png" alt="" /><!-- --></p>
</div>
<div id="simple-points" class="section level1">
<h1>Simple points</h1>
<p>The previous examples use point data. To confirm this works with points everywhere, depending on the resolution of the source data, here is another example using the bathymetry surface with <code>type=&quot;points&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">id =</span> id, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-points-1.png" alt="" /><!-- --></p>
</div>
<div id="spatialpolygon-boundary-lines" class="section level1">
<h1>Spatial/polygon boundary lines</h1>
<p><code>type=&quot;maplines&quot;</code> relies on <code>ggplot2::geom_path</code> internally, which is why it is suited to drawing ordered polygon border lines and why the original <code>borders</code> data frame contains the necessary additional variables for grouping and plotting order. While the prepared data frames used in this set of examples are provided by the package, typically you would generate these yourself from your data which were originally in another form such as <code>SpatialPolygonsDataFrame</code> or <code>RasterLayer</code> objects.</p>
<p>A common way to do this is by using <code>ggplot2::fortify</code> or, alternatively, duplicated functionality in the <code>broom</code> package. See those packages for examples or documentation. Further below I include one example “from scratch” that shows an instance of using <code>fortify</code> to make the transition from a <code>SpatialPolygonsDataFrame</code> to a “fortified” data frame that is ready to be ingested by <code>ggplot</code> inside <code>save_map</code> like the already fortified example data frames provided by <code>mapmate</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(brdrs, <span class="dt">id =</span> id, <span class="dt">type =</span> <span class="st">&quot;maplines&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-maplines1-1.png" alt="" /><!-- --></p>
<p>While we’re here, let’s also change the view using <code>lon</code>, <code>lat</code>, and <code>rotation.axis</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(brdrs, <span class="dt">id =</span> id, <span class="dt">lon =</span> -<span class="dv">70</span>, <span class="dt">lat =</span> <span class="dv">40</span>, <span class="dt">rotation.axis =</span> <span class="dv">0</span>, <span class="dt">type =</span> <span class="st">&quot;maplines&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-maplines2-1.png" alt="" /><!-- --></p>
</div>
<div id="rasterized-tiles" class="section level1">
<h1>Rasterized tiles</h1>
<p>In the previous examples there was no need to provide a third variable, a data variable. The plots are based on spatial locations only, whether points or paths. For gridded data, a <code>z</code> variable is needed and is specified with the <code>z.name</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;maptiles&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>,
    <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-maptiles-1.png" alt="" /><!-- --></p>
</div>
<div id="density-maps-and-contour-lines" class="section level1">
<h1>Density maps and contour lines</h1>
<p><code>type=&quot;density&quot;</code> combines both 2D density and 3D contour mapping under a single heading for convenience and based on the default map appearance, but it is important to remember the distinction. The previous example using <code>type=&quot;maptiles&quot;</code> is actually a special case and matches the plot output associated with the default arguments that are relevant to <code>type=&quot;density&quot;</code>.</p>
<div id="filled-contour-style-density-using-tiles" class="section level2">
<h2>Filled contour-style density using tiles</h2>
<p>Default arguments include <code>contour=&quot;none&quot;</code> and <code>density.geom=&quot;tile&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>,
    <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_default-1.png" alt="" /><!-- --></p>
<p>Explicit contour lines can also be overlaid with the base map type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_contour1-1.png" alt="" /><!-- --></p>
<p>Contour lines can also be drawn without including the base layer indicated by <code>type</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;only&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_contour2-1.png" alt="" /><!-- --></p>
<div id="contour-lines-with-points" class="section level3">
<h3>Contour lines with points</h3>
<p>As a brief aside, these options also work for <code>type=&quot;points&quot;</code>. Remember that these contour lines are based on the spatial density of lon/lat coordinates, unlike the previous contour lines examples that make use of the data variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-points_contour-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;only&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>,
    <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-points_contour-2.png" alt="" /><!-- --></p>
<p>For <code>type=&quot;points&quot;</code>, the color <code>col</code> applies to both points and contour lines, but for <code>type=&quot;density&quot;</code> <code>col</code> applies to the density map. Contour line overlays will remain as black lines. The exception is when <code>contour=&quot;only&quot;</code>, in which case <code>col</code> may still be a vector defining a color palette that will be applied to the contour lines in place of the underlying filled density map.</p>
</div>
</div>
<div id="density-maps-of-locations-no-data-variable" class="section level2">
<h2>Density maps of locations (no data variable)</h2>
<p>True density maps based on lon/lat locations rather than filled contours based on three variables can also be plotted by excluding <code>z.name</code>. The first call below includes <code>z.name=&quot;z&quot;</code> and the second does not. As expected, these are completely different maps because they use fundamentally different data in different ways.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_2Dvs3D-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>,
    <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_2Dvs3D-2.png" alt="" /><!-- --></p>
<p>Of course, this would not be interesting to do when the data frame contains gridded data at all lon/lat locations on the world grid like in <code>bathymetry</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">id =</span> id, <span class="dt">lon =</span> -<span class="dv">70</span>, <span class="dt">lat =</span> <span class="dv">50</span>, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-density_2D_boring-1.png" alt="" /><!-- --></p>
</div>
<div id="tiles-vs.polygons" class="section level2">
<h2>Tiles vs. polygons</h2>
<p>Relying internally on <code>ggplot2::geom_polygon</code> inside <code>save_map</code> can be much faster than <code>ggplot::geom_tile</code> to process the data and make maps. This is an important consideration for generating long sequences of many high-resolution maps. However, the trade off is that polygons may be drawn very poorly with much clipping, the degree of the problem depending on the given data. Of course, if tiles are drawn at an extremely coarse resolution based on the input data, they still won’t look good, and also won’t take as long to draw. It is what you decide to make of it with the data you choose to map. The below examples compare the use of tiles to polygons.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;tile&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons1-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;polygon&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons1-2.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;tile&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons1-3.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bath, <span class="dt">z.name =</span> <span class="st">&quot;z&quot;</span>, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;polygon&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons1-4.png" alt="" /><!-- --></p>
<p>Tiles may also interpolate where possible, but not extrapolate, which may not be desired behavior for a map; e.g., when drawing the continents and interpolating between them but still excluding the poles. It can lead to confusion about what is the underlying data. Yet polygons may still perform much worse, even in flat maps, as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>, <span class="dt">density.geom =</span> <span class="st">&quot;tile&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons2-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>, <span class="dt">density.geom =</span> <span class="st">&quot;polygon&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons2-2.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">ortho =</span> <span class="ot">FALSE</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;tile&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons2-3.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(temps, <span class="dt">id =</span> id, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">ortho =</span> <span class="ot">FALSE</span>, <span class="dt">contour =</span> <span class="st">&quot;overlay&quot;</span>,
    <span class="dt">density.geom =</span> <span class="st">&quot;polygon&quot;</span>, <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-tiles_polygons2-4.png" alt="" /><!-- --></p>
</div>
<div id="an-example-from-scratch" class="section level2">
<h2>An example from scratch</h2>
<p>This is also apparent when using the simpler options <code>type=&quot;polygons&quot;</code> and <code>type=&quot;maptiles&quot;</code>. The former relies on a <code>SpatialPolygonsDataFrame</code> object as the data source and the later on a <code>RasterLayer</code>. Here examples of each are compared and they are prepped from scratch using the appropriate class objects. Remember that these two map type options are essentially special cases of the density type option.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># polygons</span>
<span class="kw">library</span>(rworldmap)
<span class="kw">library</span>(rworldxtra)  <span class="co"># required for &#39;high&#39; resolution map</span>
<span class="kw">library</span>(maptools)  <span class="co"># required for fortify to work</span>
<span class="co"># also recommend installing rgeos</span>

spdf &lt;-<span class="st"> </span><span class="kw">joinCountryData2Map</span>(countryExData, <span class="dt">mapResolution =</span> <span class="st">&quot;high&quot;</span>)
spdf@data$id &lt;-<span class="st"> </span><span class="kw">rownames</span>(spdf@data)
bio &lt;-<span class="st"> </span>ggplot2::<span class="kw">fortify</span>(spdf, <span class="dt">region =</span> <span class="st">&quot;id&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">left_join</span>(<span class="kw">subset</span>(spdf@data,
    <span class="dt">select =</span> <span class="kw">c</span>(id, BIODIVERSITY)), <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">frameID =</span> <span class="dv">1</span>) %&gt;%<span class="st"> </span><span class="kw">rename</span>(<span class="dt">lon =</span> long)

<span class="co"># raster layer</span>
<span class="kw">library</span>(raster)
proj4 &lt;-<span class="st"> &quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +to wgs84=0,0,0&quot;</span>
z &lt;-<span class="st"> &quot;BIODIVERSITY&quot;</span>
<span class="co"># 1-degree resolution, still somewhat coarse</span>
r &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">extent</span>(-<span class="dv">180</span>, <span class="dv">180</span>, -<span class="dv">90</span>, <span class="dv">90</span>), <span class="dt">nrow =</span> <span class="dv">180</span>, <span class="dt">ncol =</span> <span class="dv">360</span>, proj4)
bio2 &lt;-<span class="st"> </span><span class="kw">rasterize</span>(spdf, r, <span class="dt">field =</span> z) %&gt;%<span class="st"> </span>rasterToPoints %&gt;%<span class="st"> </span><span class="kw">tbl_df</span>() %&gt;%<span class="st"> </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>,
    <span class="st">&quot;lat&quot;</span>, z)) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">frameID =</span> <span class="dv">1</span>)

clrs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;royalblue&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>)
<span class="kw">save_map</span>(bio, <span class="dt">z.name =</span> z, <span class="dt">id =</span> id, <span class="dt">lon =</span> -<span class="dv">10</span>, <span class="dt">lat =</span> <span class="dv">20</span>, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;polygons&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-polygons_tiles_scratch-1.png" alt="" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save_map</span>(bio2, <span class="dt">z.name =</span> z, <span class="dt">id =</span> id, <span class="dt">lon =</span> -<span class="dv">10</span>, <span class="dt">lat =</span> <span class="dv">20</span>, <span class="dt">col =</span> pal, <span class="dt">type =</span> <span class="st">&quot;maptiles&quot;</span>,
    <span class="dt">save.plot =</span> <span class="ot">FALSE</span>, <span class="dt">return.plot =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="README-Examples-polygons_tiles_scratch-2.png" alt="" /><!-- --></p>
<p>In conclusion, there are a variety of methods available to draw different types of data on the globe from any arbitrary perspective. Flat maps are also an option but this is not as interesting so it is not focused on. The primary uses of <code>save_map</code> among what is shown here are for plotting points, polygon borders and tiles. The rest are interesting options and can work well enough for specific use cases but are included here mainly to highlight their current limitations.</p>
<p>The one option not covered here (I will add this in a future update) is the <code>type=&quot;network&quot;</code> option, which is used for plotting a time series of maps/globes showing moving great circle arcs. This is my personal favorite use case, but it is also the most complex so I am yet to fold code for that into this package and incorporate great circle arc network examples into the various help documentation, vignettes and tutorials. Something more to look forward to.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
